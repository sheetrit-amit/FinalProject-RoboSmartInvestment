# ניתוח נתונים - פרויקט גמר

## פרק 1: תיאור הנתונים

### 1.1 מקור הנתונים

הנתונים בפרויקט נאספים מ-**Yahoo Finance** באמצעות ספריית `yfinance` של Python. 
Yahoo Finance הוא מקור נתונים פיננסיים מוכר ונגיש המספק מידע היסטורי על מניות, כולל נתוני מחירים יומיים ודוחות פיננסיים.

הנתונים נשמרים ב-**Google BigQuery** - שירות מסד נתונים בענן של Google המאפשר אחסון וניתוח של כמויות גדולות של נתונים.

---

### 1.2 היקף הנתונים

| מאפיין | ערך |
|--------|------|
| מספר חברות | 1,001 חברות |
| טווח זמן | 23/11/2020 עד 20/11/2025 (~5 שנים) |
| תדירות נתוני מחירים | יומית |
| תדירות דוחות פיננסיים | רבעונית + שנתית |
| סה"כ שורות נתוני מחירים | 1,274,017 |
| סה"כ שורות דוחות רווח והפסד | 5,412 |
| סה"כ שורות מאזנים | 5,486 |
| סה"כ שורות תזרימי מזומנים | 5,627 |

---

### 1.3 תיאור הטבלאות והשדות

#### טבלה 1: `daily_prices` - נתוני מחירים יומיים

טבלה זו מכילה את נתוני המסחר היומיים של כל המניות.

| שם השדה | סוג הנתון | תיאור |
|---------|-----------|--------|
| `ticker` | STRING | סימול המניה בבורסה (לדוגמה: AAPL, GOOGL, MSFT) |
| `date` | DATE | תאריך יום המסחר |
| `open` | FLOAT64 | מחיר הפתיחה - המחיר בו נפתח המסחר באותו יום |
| `high` | FLOAT64 | המחיר הגבוה ביותר שהושג במהלך יום המסחר |
| `low` | FLOAT64 | המחיר הנמוך ביותר שהושג במהלך יום המסחר |
| `close` | FLOAT64 | מחיר הסגירה - המחיר בו נסגר המסחר באותו יום |
| `volume` | INT64 | נפח המסחר - כמות המניות שנסחרו באותו יום |
| `dividends` | FLOAT64 | דיבידנד ששולם באותו תאריך (0 אם לא שולם) |
| `stock_splits` | FLOAT64 | יחס פיצול מניות (1 אם לא היה פיצול) |

---

#### טבלה 2: `income_statements` - דוחות רווח והפסד

טבלה זו מכילה נתונים מדוחות הרווח וההפסד של החברות (5,412 שורות, 492 מניות).

| שם השדה | סוג הנתון | תיאור |
|---------|-----------|--------|
| `ticker` | STRING | סימול המניה |
| `report_date` | DATE | תאריך הדוח הכספי |
| `period_type` | STRING | סוג התקופה: 'quarterly' (רבעוני) או 'annual' (שנתי) |
| `total_revenue` | FLOAT64 | סך ההכנסות - כלל ההכנסות של החברה בתקופה |
| `gross_profit` | FLOAT64 | רווח גולמי - הכנסות פחות עלות המכר |
| `operating_income` | FLOAT64 | רווח תפעולי - רווח גולמי פחות הוצאות תפעול |
| `net_income` | FLOAT64 | רווח נקי - הרווח הסופי אחרי כל ההוצאות והמיסים |
| `ebitda` | FLOAT64 | רווח לפני ריבית, מיסים, פחת והפחתות |
| `basic_eps` | FLOAT64 | רווח למניה בסיסי |
| `diluted_eps` | FLOAT64 | רווח למניה מדולל |
| `cost_of_revenue` | FLOAT64 | עלות ההכנסות |
| `operating_expense` | FLOAT64 | הוצאות תפעול |
| `interest_expense` | FLOAT64 | הוצאות ריבית |
| `tax_provision` | FLOAT64 | הוצאות מס |

---

#### טבלה 3: `balance_sheets` - מאזנים

טבלה זו מכילה נתונים מהמאזנים של החברות (5,486 שורות, 491 מניות).

| שם השדה | סוג הנתון | תיאור |
|---------|-----------|--------|
| `ticker` | STRING | סימול המניה |
| `report_date` | DATE | תאריך הדוח |
| `period_type` | STRING | סוג התקופה |
| `total_assets` | FLOAT64 | סך הנכסים - כלל הנכסים של החברה |
| `total_liabilities` | FLOAT64 | סך ההתחייבויות |
| `stockholders_equity` | FLOAT64 | הון עצמי - ההון השייך לבעלי המניות |
| `current_assets` | FLOAT64 | נכסים שוטפים - נכסים שניתן להמיר למזומן תוך שנה |
| `current_liabilities` | FLOAT64 | התחייבויות שוטפות - חובות לפירעון תוך שנה |
| `total_debt` | FLOAT64 | סך החוב הפיננסי |
| `cash_and_equivalents` | FLOAT64 | מזומנים ושווי מזומנים |
| `inventory` | FLOAT64 | מלאי |
| `accounts_receivable` | FLOAT64 | לקוחות - חובות של לקוחות לחברה |
| `accounts_payable` | FLOAT64 | ספקים - חובות של החברה לספקים |
| `retained_earnings` | FLOAT64 | עודפים - רווחים שלא חולקו כדיבידנד |

---

#### טבלה 4: `cash_flows` - תזרימי מזומנים

טבלה זו מכילה נתונים מדוחות תזרים המזומנים (5,627 שורות, 491 מניות).

| שם השדה | סוג הנתון | תיאור |
|---------|-----------|--------|
| `ticker` | STRING | סימול המניה |
| `report_date` | DATE | תאריך הדוח |
| `period_type` | STRING | סוג התקופה |
| `operating_cash_flow` | FLOAT64 | תזרים מפעילות שוטפת - מזומנים מהפעילות העסקית |
| `investing_cash_flow` | FLOAT64 | תזרים מפעילות השקעה - רכישות/מכירות של נכסים |
| `financing_cash_flow` | FLOAT64 | תזרים מפעילות מימון - הלוואות, דיבידנדים, הנפקות |
| `free_cash_flow` | FLOAT64 | תזרים חופשי - מזומן זמין לחלוקה למשקיעים |
| `capital_expenditure` | FLOAT64 | הוצאות הון - השקעות בנכסים קבועים |
| `depreciation` | FLOAT64 | פחת והפחתות |
| `change_in_working_capital` | FLOAT64 | שינוי בהון חוזר |

---

## פרק 2: ניתוח אקספלורטורי (EDA)

### 2.1 סקירה כללית של הנתונים

הנתונים כוללים מידע על **1,001 חברות ציבוריות** בארה"ב, הנסחרות בבורסות NYSE ו-NASDAQ. החברות נבחרו לפי שווי שוק (Market Cap) ומייצגות את המניות המשמעותיות ביותר בשוק האמריקאי.

הנתונים מכסים תקופה של כ-5 שנים (נובמבר 2020 - נובמבר 2025), הכוללת אירועים משמעותיים כמו:
- התאוששות ממשבר הקורונה (2020-2021)
- עליית הריבית (2022-2023)
- צמיחת מניות הטכנולוגיה והבינה המלאכותית (2023-2024)

**סטטיסטיקות כלליות:**

| מדד | ערך |
|-----|------|
| מספר תצפיות תשואה | 1,272,749 |
| תשואה יומית ממוצעת | 0.0524% |
| תשואה שנתית משוערת | 13.21% |
| סטיית תקן יומית | 2.97% |
| תנודתיות שנתית | 47.08% |

---

### 2.2 אתגרים בנתונים

#### אתגר 1: ערכים חסרים בדוחות הפיננסיים

**ממצאים בפועל:**

**income_statements (5,499 שורות):**
| שדה | ערכים חסרים | אחוז |
|-----|-------------|------|
| total_revenue | 999 | 18.2% |
| gross_profit | 1,429 | 26.0% |
| operating_income | 1,402 | 25.5% |
| net_income | 999 | 18.2% |
| ebitda | 1,404 | 25.5% |

**balance_sheets (5,577 שורות):**
| שדה | ערכים חסרים | אחוז |
|-----|-------------|------|
| total_assets | 1,086 | 19.5% |
| total_liabilities | 1,086 | 19.5% |
| stockholders_equity | 1,086 | 19.5% |
| total_debt | 1,104 | 19.8% |

**cash_flows (5,723 שורות):**
| שדה | ערכים חסרים | אחוז |
|-----|-------------|------|
| operating_cash_flow | 1,232 | 21.5% |
| free_cash_flow | 1,232 | 21.5% |
| capital_expenditure | 1,453 | 25.4% |

**השפעה על הניתוח:**
- כ-20-25% מהנתונים בדוחות הפיננסיים חסרים
- מקשה על חישוב יחסים פיננסיים מסוימים
- דורש טיפול לפני הכנסה למודלים (מילוי/הסרה)

---

#### אתגר 2: התפלגות לא-נורמלית של תשואות

**ממצאים בפועל (מבוססים על 1,272,648 תצפיות):**

| מדד | ערך | משמעות |
|-----|------|---------|
| Skewness (אסימטריה) | 0.3233 | הטיה קלה ימינה (תשואות חיוביות קיצוניות שכיחות יותר) |
| Kurtosis (עודף קורטוסיס) | **20.83** | גבוה מאוד! (נורמלי = 0) |
| בדיקת Shapiro-Wilk | p < 0.001 | התשואות **לא** מתפלגות נורמלית |

**התפלגות אחוזונים:**
| אחוזון | תשואה יומית |
|--------|-------------|
| 1% | -7.26% |
| 5% | -3.79% |
| 25% | -1.12% |
| 50% (חציון) | 0.00% |
| 75% | 1.18% |
| 95% | 3.87% |
| 99% | 7.74% |

**משמעות:** Kurtosis של 20.83 מצביע על "זנבות שמנים" משמעותיים - אירועים קיצוניים (ירידות/עליות חדות) קורים הרבה יותר מהצפוי בהתפלגות נורמלית.

---

#### אתגר 3: כיסוי נתונים לא אחיד

**ממצאים בפועל:**

| מדד | ערך |
|-----|------|
| ממוצע ימי מסחר למניה | 1,273 |
| חציון ימי מסחר | 1,255 |
| מינימום | 39 ימים (WOLF) |
| מקסימום | 2,510 ימים |

**התפלגות לפי כמות ימי מסחר:**
| קטגוריה | מספר מניות |
|----------|-------------|
| פחות מ-500 ימים | 2 מניות |
| 500-1000 ימים | 7 מניות |
| 1000+ ימים | 992 מניות |

**מניות עם מעט נתונים:**
- WOLF: 39 ימים בלבד
- VG: 209 ימים

**מסקנה:** רוב המניות (99.1%) מכילות מעל 500 ימי מסחר - כיסוי טוב מאוד.

---

#### אתגר 4: קורלציות משתנות בין סקטורים

**ממצאים בפועל - קורלציות בתוך סקטורים:**

| סקטור | מניות | קורלציה ממוצעת |
|-------|-------|----------------|
| אנרגיה | XOM-CVX | **0.858** |
| בנקאות | JPM-BAC | **0.820** |
| טכנולוגיה | AAPL, MSFT, GOOGL, META, NVDA | 0.569 |

**Top 10 זוגות עם קורלציה גבוהה:**
| זוג | קורלציה |
|-----|---------|
| CVX-XOM | 0.858 |
| BAC-JPM | 0.820 |
| AMZN-MSFT | 0.659 |
| GOOGL-MSFT | 0.655 |
| AAPL-MSFT | 0.635 |
| MSFT-NVDA | 0.630 |
| AMZN-GOOGL | 0.619 |
| AMZN-META | 0.602 |
| META-MSFT | 0.592 |
| AAPL-GOOGL | 0.578 |

**זוגות עם קורלציה נמוכה (דיברסיפיקציה טובה):**
| זוג | קורלציה |
|-----|---------|
| JNJ-NVDA | **-0.096** |
| JNJ-TSLA | -0.013 |
| AMZN-JNJ | 0.013 |
| KO-NVDA | 0.015 |
| JNJ-META | 0.020 |

**קורלציות בין סקטורים:**
| זוג | סקטורים | קורלציה |
|-----|---------|---------|
| AAPL-JPM | טכנולוגיה-בנקאות | 0.347 |
| AAPL-XOM | טכנולוגיה-אנרגיה | 0.186 |
| NVDA-WMT | טכנולוגיה-קמעונאות | 0.129 |

**מסקנה:** קורלציות בתוך סקטור גבוהות (0.57-0.86), בין סקטורים נמוכות יחסית (0.13-0.35). דיברסיפיקציה יעילה דורשת פיזור בין סקטורים.

---

#### אתגר 5: סקאלות שונות

**ממצאים בפועל:**

**מחירי מניות:**
| מדד | ערך |
|-----|------|
| ממוצע | $121.01 |
| חציון | $63.62 |
| מינימום | $0.00 |
| מקסימום | $9,924.40 |

**נפח מסחר:**
| מדד | ערך |
|-----|------|
| ממוצע | 4,083,523 |
| מינימום | 0 |
| מקסימום | 1,895,249,600 |

**משמעות:** טווח מחירים של $0 עד $9,924 וטווח נפחים של 0 עד 1.9 מיליארד - הבדלים אדירים בסקאלה. מודלים רבים יידרשו נרמול.

---

### 2.3 ממצאים מרכזיים

#### ממצא 1: קורלציות גבוהות בתוך סקטורים

מניות מאותו סקטור מציגות קורלציה גבוהה ומשמעותית:
- **אנרגיה (XOM-CVX):** קורלציה 0.858 - הגבוהה ביותר
- **בנקאות (JPM-BAC):** קורלציה 0.820
- **טכנולוגיה (5 מניות):** קורלציה ממוצעת 0.569

**משמעות פרקטית:** דיברסיפיקציה יעילה דורשת פיזור בין סקטורים, לא רק בין מניות באותו סקטור.

---

#### ממצא 2: תנודתיות משתנה לאורך זמן (Volatility Clustering)

**ממצאים בפועל:**

| מדד | ערך |
|-----|------|
| תנודתיות ממוצעת | 45.6% |
| תנודתיות מינימלית | 33.1% (ספטמבר 2023) |
| תנודתיות מקסימלית | **108.6%** (מאי 2023) |

**תקופות עם תנודתיות גבוהה (מעל 50%):**
| תקופה | תנודתיות שנתית |
|--------|-----------------|
| מאי 2023 | **108.6%** |
| אפריל 2025 | 66.1% |
| אוגוסט 2024 | 64.8% |
| מאי 2022 | 61.2% |
| נובמבר 2022 | 56.6% |

**משמעות:** תקופות של תנודתיות גבוהה מגיעות באשכולות. תנודתיות עבר מנבאת תנודתיות עתידית.

---

#### ממצא 3: פערי ביצועים משמעותיים בין מניות

**Top 10 מניות לפי Sharpe Ratio:**
| מניה | תשואה שנתית | תנודתיות | Sharpe Ratio |
|------|-------------|----------|--------------|
| MCK | 35.2% | 22.9% | **1.54** |
| HWM | 47.6% | 32.1% | 1.48 |
| LLY | 46.1% | 32.1% | 1.44 |
| CEG | 68.0% | 49.2% | 1.38 |
| TRGP | 46.5% | 33.7% | 1.38 |
| CAH | 33.4% | 24.9% | 1.34 |
| MLI | 43.2% | 32.5% | 1.33 |
| AVGO | 54.9% | 41.5% | 1.32 |
| GE | 40.5% | 30.8% | 1.32 |
| CRS | 62.0% | 48.1% | 1.29 |

**Bottom 10 מניות לפי Sharpe Ratio:**
| מניה | תשואה שנתית | תנודתיות | Sharpe Ratio |
|------|-------------|----------|--------------|
| CABO | -46.6% | 46.6% | **-1.00** |
| SEAT | -61.8% | 68.0% | -0.91 |
| TDOC | -46.4% | 63.8% | -0.73 |
| BAX | -22.4% | 31.0% | -0.72 |
| FMC | -31.2% | 43.8% | -0.71 |
| XRAY | -24.3% | 35.5% | -0.68 |
| CHGG | -51.6% | 81.7% | -0.63 |
| GLPG | -22.2% | 35.6% | -0.62 |
| TTGT | -33.1% | 54.6% | -0.61 |
| TTEC | -40.1% | 66.6% | -0.60 |

**משמעות:** פער עצום בין המניות הטובות (Sharpe +1.5) לגרועות (Sharpe -1.0). בחירת מניות נכונה קריטית.

---

#### ממצא 4: זנבות שמנים (Fat Tails) בתשואות

**ממצאים:**
- Kurtosis של **20.83** (נורמלי = 0)
- תשואות קיצוניות שכיחות פי כמה מהצפוי

**דוגמה מספרית:**
- בהתפלגות נורמלית, תשואה של ±7% צפויה ב-0.006% מהימים
- בנתונים שלנו, תשואות של ±7% מופיעות ב-2% מהימים (פי 300!)

**משמעות:** מודלים שמניחים נורמליות (כולל מרקוביץ') יזלזלו בסיכון.

---

### 2.4 סיכום והמלצות

#### טבלת אתגרים ופתרונות:

| אתגר | ממצא | פתרון מוצע |
|------|------|------------|
| ערכים חסרים | 18-26% בדוחות פיננסיים | מילוי בחציון סקטוריאלי או הסרת שורות |
| לא-נורמליות | Kurtosis = 20.83 | שימוש ב-HRP/Risk Parity במקום מרקוביץ' |
| כיסוי לא אחיד | 2 מניות עם <500 ימים | סינון מניות עם מינימום 500 ימי מסחר |
| קורלציות משתנות | 0.13-0.86 לפי סקטור | שימוש בקורלציות מתגלגלות, פיזור בין סקטורים |
| סקאלות שונות | מחירים $0-$9,924 | נרמול/סטנדרטיזציה לפני מודלים |

---

## סיכום

הנתונים שנאספו מספקים בסיס מוצק לניתוח פיננסי ובניית מודלים:
- **1,274,017** נתוני מחירים יומיים
- **~16,500** שורות דוחות פיננסיים
- **1,001** חברות עם כיסוי טוב (99% עם >500 ימי מסחר)

האתגרים העיקריים לטיפול:
1. ערכים חסרים בדוחות (18-26%)
2. זנבות שמנים בתשואות (Kurtosis = 20.83)
3. קורלציות גבוהות בתוך סקטורים

עם טיפול מתאים באתגרים אלו, ניתן לבנות מודלים אפקטיביים לניתוח סיכון ואופטימיזציית תיקים.
